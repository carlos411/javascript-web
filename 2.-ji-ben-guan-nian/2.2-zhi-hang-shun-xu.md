# 2.2 JS 與頁面的執行順序

## 一般執行順序

假設完整原始碼如下：

```markup
<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <title></title>
    
    <!-- 下載、執行 -->
    <link rel="stylesheet" href="./css/index.css">
  </head>
  <body>
    <div class="block">
      這是 div 區塊
      <p class="para">這是段落</p>
    </div>

    <br>

    <button type="button" id="btn1">取得內容</button>
    <button type="button" id="btn2">更新內容</button>
    <button type="button" id="btn3">刪除元素節點</button>
    <button type="button" id="btn4">建立元素節點</button>
    
    <!-- 下載、執行 -->
    <script src="./js/index.js"></script>
  </body>
</html>
```

示意圖：

![](../.gitbook/assets/js\_general.png)



## script 標籤屬性 defer

改成如下(僅顯示 `<head>` 區段)：

```markup
<head>
  <meta charset="utf-8">
  <title></title>
  
  <link rel="stylesheet" href="./css/index.css">
  <script src="./js/index.js" defer></script>
</head>
```

瀏覽器上執行的順序：

1. 瀏覽器下載並執行 index.css 檔案。
2. 瀏覽器下載 index.js，同時 body 標籤裡的原始碼會繼續執行渲染畫面。
3. index.js 下載完後，還不會執行裡面的程式，而是等到 body 標籤裡的原始碼在畫面上都渲染完後，才執行。

示意圖：

![](<../.gitbook/assets/js\_defer (2).png>)

## script 標籤屬性 async

改成在 script 標籤，加上 async 屬性：

```markup
<head>
  <meta charset="utf-8">
  <title></title>
  
  <link rel="stylesheet" href="./css/index.css">
  <script src="./js/index.js" async></script>
</head>
```

瀏覽器上執行的情況：

1. 瀏覽器下載並執行 index.css 檔案。
2. 瀏覽器下載 index.js，同時 body 標籤裡的原始碼會繼續執行渲染畫面。
3. index.js 下載完後，執行 index.js 裡面的程式，同時網頁畫面的渲染停下，所以**有可能**發生在執行 index.js 的時候，取用到了 畫面上還未出現的元素，造成錯誤。
4. 執行完 index.js 程式之後，繼續渲染畫面。

示意圖：

![](<../.gitbook/assets/js\_async (1).png>)



測試結果影片：

{% embed url="https://youtu.be/fms_AVoKH3E" %}







## 結論

* 留意與 html 的相依性，視情況使用 `async` 與 `defer` 屬性，這兩個屬性只適用於 script 標籤，其它標籤不適用。
* 維持 JS 外部檔案的載入，放在 `</body>` 結束標籤之前。

